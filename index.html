<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ø§Ø© ØªØ­Ù…ÙŠÙ„ TikTok â€“ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <style>
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --success: #00c853;
            --warning: #ffab00;
            --danger: #ff1744;
            --info: #2979ff;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .api-test {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-right: 4px solid var(--warning);
        }
        .server-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        .server-item {
            padding: 8px;
            background: white;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #e0e0e0;
            font-size: 0.9rem;
        }
        .server-online {
            border-color: var(--success);
            background: #f0fff0;
        }
        .server-offline {
            border-color: var(--danger);
            background: #fff0f0;
        }
        .server-intermittent {
            border-color: var(--warning);
            background: #fffbf0;
        }
        #loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        #loading div {
            border: 5px solid rgba(106, 17, 203, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--primary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #errorMessage {
            display: none;
            background: rgba(244, 67, 54, 0.1);
            padding: 15px;
            border-radius: 10px;
            color: var(--danger);
            border-right: 4px solid var(--danger);
            margin: 10px 0;
        }
        #successMessage {
            display: none;
            background: rgba(0, 200, 83, 0.1);
            padding: 15px;
            border-radius: 10px;
            color: var(--success);
            border-right: 4px solid var(--success);
            margin: 10px 0;
        }
        #resultSection {
            display: none;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            text-align: center;
        }
        #videoPreview {
            width: 100%;
            max-width: 100%;
            border-radius: 10px;
            margin: 20px 0;
            background: #000;
        }
        button {
            padding: 15px 25px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        #downloadBtn {
            background: var(--success);
        }
        .video-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: right;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success), var(--info));
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ Ø£Ø¯Ø§Ø© ØªØ­Ù…ÙŠÙ„ TikTok Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h1>
            <p style="color: #666;">ÙŠØ¯Ø¹Ù… 15+ Ø®Ø§Ø¯Ù… Ù…Ø®ØªÙ„Ù - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù†</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalServers">0</div>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ÙˆØ§Ø¯Ù…</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeServers">0</div>
                <div>Ø§Ù„Ù†Ø´Ø·Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">100%</div>
                <div>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDownloads">0</div>
                <div>Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</div>
            </div>
        </div>

        <div class="api-test" id="apiTest">
            <h3>ğŸ” ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø¯Ù…...</h3>
            <div class="server-list" id="serverList"></div>
        </div>

        <section style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
            <label for="videoUrl" style="font-weight: bold; color: #333; display: block; margin-bottom: 10px;">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ TikTok:</label>
            <input type="url" id="videoUrl" placeholder="https://www.tiktok.com/@username/video/1234567890" required
                   style="padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; width: 100%; margin-bottom: 10px;">
            
            <div id="errorMessage"></div>
            <div id="successMessage"></div>
            
            <button id="fetchBtn">
                <span>ğŸš€ Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©</span>
            </button>
        </section>

        <div id="loading">
            <div></div>
            <p id="loadingText">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <section id="resultSection">
            <h2>âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!</h2>
            
            <div class="video-info">
                <h3 id="videoTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h3>
                <p id="videoAuthor">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: @username</p>
                <p id="videoDuration">Ø§Ù„Ù…Ø¯Ø©: ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</p>
                <p id="apiSource">Ø§Ù„Ù…ØµØ¯Ø±: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
            
            <video id="videoPreview" controls></video>
            
            <button id="downloadBtn">
                <span>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†</span>
            </button>
        </section>

        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 20px;">
            <h3>âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© (15+ Ø®Ø§Ø¯Ù…):</h3>
            <div style="columns: 2; gap: 20px; margin: 15px 0;">
                <div>
                    <h4>ğŸŸ¢ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù†Ø´Ø·Ø©:</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li><strong>TikWM</strong> - Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ù…Ø¶Ù…ÙˆÙ†</li>
                        <li><strong>SSSTik</strong> - Ø¨Ø¯ÙŠÙ„ Ø³Ø±ÙŠØ¹</li>
                        <li><strong>TikSave</strong> - Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸŸ¡ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù…ØªÙ‚Ø·Ø¹Ø©:</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li><strong>TikDown</strong> - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯</li>
                        <li><strong>SnapTik</strong> - Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯</li>
                        <li><strong>DownTik</strong> - Ø¨Ø¯ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ”§ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li><strong>TikTokX</strong> - Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</li>
                        <li><strong>TikFull</strong> - Ø®Ø§Ø¯Ù… Ø­Ø¯ÙŠØ«</li>
                        <li><strong>TikMate</strong> - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸŒ Ø®ÙˆØ§Ø¯Ù… TikTok Ø§Ù„Ø±Ø³Ù…ÙŠØ©:</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li><strong>TikTok API</strong> - Ù…Ø¨Ø§Ø´Ø±</li>
                        <li><strong>TikTok Webcast</strong> - Ù„Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ======
        const ALL_TIKTOK_SERVERS = [
            // âœ… Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø¶Ù…ÙˆÙ†Ø©
            { 
                name: "TikWM", 
                url: "https://www.tikwm.com/api/", 
                method: "POST", 
                testUrl: "https://www.tikwm.com",
                working: false,
                priority: 1,
                type: "active"
            },
            { 
                name: "SSSTik", 
                url: "https://ssstik.io/api", 
                method: "POST", 
                testUrl: "https://ssstik.io",
                working: false,
                priority: 2,
                type: "active"
            },
            { 
                name: "TikSave", 
                url: "https://tiksave.org/api/", 
                method: "POST", 
                testUrl: "https://tiksave.org",
                working: false,
                priority: 3,
                type: "active"
            },
            
            // ğŸŸ¡ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù…ØªÙ‚Ø·Ø¹Ø©
            { 
                name: "TikDown", 
                url: "https://tikdown.org/api", 
                method: "GET", 
                testUrl: "https://tikdown.org",
                working: false,
                priority: 4,
                type: "intermittent"
            },
            { 
                name: "SnapTik", 
                url: "https://snaptik.one/api", 
                method: "GET", 
                testUrl: "https://snaptik.one",
                working: false,
                priority: 5,
                type: "intermittent"
            },
            { 
                name: "DownTik", 
                url: "https://downtik.net/api/", 
                method: "GET", 
                testUrl: "https://downtik.net",
                working: false,
                priority: 6,
                type: "intermittent"
            },
            
            // ğŸ”§ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            { 
                name: "TikTokX", 
                url: "https://tiktokx.com/api/download", 
                method: "POST", 
                testUrl: "https://tiktokx.com",
                working: false,
                priority: 7,
                type: "experimental"
            },
            { 
                name: "TikFull", 
                url: "https://tikfull.com/api/", 
                method: "POST", 
                testUrl: "https://tikfull.com",
                working: false,
                priority: 8,
                type: "experimental"
            },
            { 
                name: "TikMate", 
                url: "https://tikmate.app/api/", 
                method: "GET", 
                testUrl: "https://tikmate.app",
                working: false,
                priority: 9,
                type: "experimental"
            },
            
            // ğŸŒ Ø®ÙˆØ§Ø¯Ù… TikTok Ø§Ù„Ø±Ø³Ù…ÙŠØ©
            { 
                name: "TikTok API", 
                url: "https://api16-normal-c-useast1a.tiktokv.com/aweme/v1/feed/", 
                method: "GET", 
                testUrl: "https://tiktokv.com",
                working: false,
                priority: 10,
                type: "official"
            },
            { 
                name: "TikTok Webcast", 
                url: "https://webcast.tiktok.com/webcast/feed/", 
                method: "GET", 
                testUrl: "https://webcast.tiktok.com",
                working: false,
                priority: 11,
                type: "official"
            },
            
            // ğŸ“š Ø®ÙˆØ§Ø¯Ù… Ø¥Ø¶Ø§ÙÙŠØ©
            { 
                name: "SaveTik", 
                url: "https://api.savetik.app/api/info", 
                method: "GET", 
                testUrl: "https://savetik.app",
                working: false,
                priority: 12,
                type: "additional"
            },
            { 
                name: "Snapsave", 
                url: "https://snapsave.io/tiktok-downloader", 
                method: "GET", 
                testUrl: "https://snapsave.io",
                working: false,
                priority: 13,
                type: "additional"
            },
            { 
                name: "TTDownloader", 
                url: "https://ttdownloader.com/req/", 
                method: "GET", 
                testUrl: "https://ttdownloader.com",
                working: false,
                priority: 14,
                type: "additional"
            },
            { 
                name: "TikTok oEmbed", 
                url: "https://www.tiktok.com/oembed", 
                method: "GET", 
                testUrl: "https://tiktok.com",
                working: false,
                priority: 15,
                type: "official"
            }
        ];

        // ====== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ======
        class Statistics {
            constructor() {
                this.totalDownloads = 0;
                this.successfulDownloads = 0;
                this.failedDownloads = 0;
                this.loadFromStorage();
            }

            recordDownload(success) {
                this.totalDownloads++;
                if (success) {
                    this.successfulDownloads++;
                } else {
                    this.failedDownloads++;
                }
                this.saveToStorage();
                this.updateDisplay();
            }

            getSuccessRate() {
                return this.totalDownloads > 0 ? 
                    Math.round((this.successfulDownloads / this.totalDownloads) * 100) : 100;
            }

            saveToStorage() {
                const data = {
                    totalDownloads: this.totalDownloads,
                    successfulDownloads: this.successfulDownloads,
                    failedDownloads: this.failedDownloads
                };
                localStorage.setItem('tiktok_stats', JSON.stringify(data));
            }

            loadFromStorage() {
                const saved = localStorage.getItem('tiktok_stats');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.totalDownloads = data.totalDownloads || 0;
                    this.successfulDownloads = data.successfulDownloads || 0;
                    this.failedDownloads = data.failedDownloads || 0;
                }
                this.updateDisplay();
            }

            updateDisplay() {
                document.getElementById('totalDownloads').textContent = this.totalDownloads;
                document.getElementById('successRate').textContent = this.getSuccessRate() + '%';
            }
        }

        // ====== ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø¯Ù… ======
        async function checkServers() {
            const serverList = document.getElementById('serverList');
            serverList.innerHTML = '';
            
            let workingServers = 0;
            const totalServers = ALL_TIKTOK_SERVERS.length;

            for (const api of ALL_TIKTOK_SERVERS) {
                const serverItem = document.createElement('div');
                serverItem.className = 'server-item';
                serverItem.innerHTML = `
                    <strong>${api.name}</strong>
                    <div>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
                `;
                serverList.appendChild(serverItem);

                try {
                    const response = await fetch(api.testUrl, { 
                        method: 'HEAD',
                        signal: AbortSignal.timeout(4000)
                    });
                    
                    if (response.ok) {
                        api.working = true;
                        workingServers++;
                        serverItem.className = `server-item server-${api.type === 'active' ? 'online' : 'intermittent'}`;
                        serverItem.innerHTML = `
                            <strong>${api.name}</strong>
                            <div style="color: ${api.type === 'active' ? 'var(--success)' : 'var(--warning)'}">
                                ${api.type === 'active' ? 'âœ…' : 'ğŸŸ¡'} ${api.type === 'active' ? 'Ù†Ø´Ø·' : 'Ù…ØªÙ‚Ø·Ø¹'}
                            </div>
                        `;
                    } else {
                        throw new Error('Server not responding');
                    }
                } catch (error) {
                    api.working = false;
                    serverItem.className = 'server-item server-offline';
                    serverItem.innerHTML = `
                        <strong>${api.name}</strong>
                        <div style="color: var(--danger);">âŒ ØºÙŠØ± Ù…ØªØ§Ø­</div>
                    `;
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('totalServers').textContent = totalServers;
            document.getElementById('activeServers').textContent = workingServers;
            
            document.querySelector('#apiTest h3').innerHTML = `
                ${workingServers > 0 ? 'âœ…' : 'âš ï¸'} Ø­Ø§Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø¯Ù…: ${workingServers}/${totalServers} Ù†Ø´Ø·
            `;
        }

        // ====== ÙƒÙ„Ø§Ø³ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø³Ù† ======
        class ComprehensiveTikTokDownloader {
            constructor() {
                this.currentVideo = null;
                this.currentServer = null;
            }

            async downloadVideo(videoUrl) {
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„Ù†Ø´Ø§Ø·
                const prioritizedServers = ALL_TIKTOK_SERVERS
                    .filter(api => api.working)
                    .sort((a, b) => a.priority - b.priority);

                if (prioritizedServers.length === 0) {
                    throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ÙˆØ§Ø¯Ù… Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ...');
                }

                console.log(`Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù†Ø´Ø·Ø©: ${prioritizedServers.map(s => s.name).join(', ')}`);

                for (const api of prioritizedServers) {
                    try {
                        console.log(`Ø¬Ø±Ø¨ ${api.name}...`);
                        const result = await this.tryApi(api, videoUrl);
                        if (result && result.success) {
                            this.currentVideo = result.data;
                            this.currentServer = api.name;
                            return result;
                        }
                    } catch (error) {
                        console.log(`ÙØ´Ù„ ${api.name}:`, error.message);
                        continue;
                    }
                }

                throw new Error('ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }

            async tryApi(api, videoUrl) {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 10000);

                try {
                    let apiUrl;
                    let options = {
                        method: api.method,
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                            'Accept': 'application/json, text/plain, */*',
                            'Accept-Language': 'en-US,en;q=0.9',
                            'Referer': 'https://www.tiktok.com/'
                        },
                        signal: controller.signal
                    };

                    if (api.method === "POST") {
                        options.headers['Content-Type'] = 'application/json';
                        options.body = JSON.stringify({ url: videoUrl });
                        apiUrl = api.url;
                    } else {
                        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ API
                        if (api.name.includes("TikTok API")) {
                            const videoId = this.extractVideoId(videoUrl);
                            apiUrl = `${api.url}?aweme_id=${videoId}`;
                        } else if (api.name.includes("TikTok oEmbed")) {
                            apiUrl = `${api.url}?url=${encodeURIComponent(videoUrl)}`;
                        } else {
                            apiUrl = `${api.url}?url=${encodeURIComponent(videoUrl)}`;
                        }
                    }

                    const response = await fetch(apiUrl, options);
                    clearTimeout(timeout);

                    if (!response.ok) {
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${response.status}`);
                    }

                    const data = await response.json();
                    return this.parseApiResponse(api.name, data);

                } catch (error) {
                    clearTimeout(timeout);
                    throw error;
                }
            }

            extractVideoId(url) {
                const patterns = [
                    /\/video\/(\d+)/,
                    /\/v\/(\d+)/,
                    /tiktok\.com\/@.+\/video\/(\d+)/,
                    /vt\.tiktok\.com\/(\w+)/,
                    /vm\.tiktok\.com\/(\w+)/
                ];
                
                for (const pattern of patterns) {
                    const matches = url.match(pattern);
                    if (matches && matches[1]) {
                        return matches[1];
                    }
                }
                
                return url.split('/').pop();
            }

            parseApiResponse(apiName, data) {
                switch (apiName) {
                    case "TikWM":
                        if (data.code === 0 && data.data) {
                            let videoUrl = data.data.play;
                            if (videoUrl && !videoUrl.startsWith('http')) {
                                videoUrl = 'https:' + videoUrl;
                            }
                            return {
                                success: true,
                                data: {
                                    videoUrl: videoUrl,
                                    title: data.data.title || "ÙÙŠØ¯ÙŠÙˆ TikTok",
                                    author: data.data.author?.unique_id || "Ù…Ø³ØªØ®Ø¯Ù…",
                                    duration: data.data.duration
                                }
                            };
                        }
                        break;

                    case "SSSTik":
                    case "TikSave":
                    case "TikDown":
                    case "SnapTik":
                    case "DownTik":
                    case "TikTokX":
                    case "TikFull":
                    case "TikMate":
                    case "SaveTik":
                        if (data.video_url || data.url) {
                            return {
                                success: true,
                                data: {
                                    videoUrl: data.video_url || data.url,
                                    title: data.title || "ÙÙŠØ¯ÙŠÙˆ TikTok",
                                    author: data.author || "Ù…Ø³ØªØ®Ø¯Ù…",
                                    duration: data.duration
                                }
                            };
                        }
                        break;

                    case "TikTok API":
                        if (data.aweme_list && data.aweme_list[0] && data.aweme_list[0].video) {
                            const video = data.aweme_list[0].video;
                            return {
                                success: true,
                                data: {
                                    videoUrl: video.play_addr.url_list[0],
                                    title: data.aweme_list[0].desc || "ÙÙŠØ¯ÙŠÙˆ TikTok",
                                    author: data.aweme_list[0].author?.unique_id || "Ù…Ø³ØªØ®Ø¯Ù…",
                                    duration: video.duration
                                }
                            };
                        }
                        break;

                    case "TikTok oEmbed":
                        if (data.html) {
                            return {
                                success: true,
                                data: {
                                    videoUrl: `https://www.tiktok.com/embed/${this.extractVideoId(videoUrl)}`,
                                    title: data.title || "ÙÙŠØ¯ÙŠÙˆ TikTok",
                                    author: data.author_name || "Ù…Ø³ØªØ®Ø¯Ù…",
                                    fallback: true
                                }
                            };
                        }
                        break;

                    default:
                        if (data.video_url || data.url || data.data?.play) {
                            return {
                                success: true,
                                data: {
                                    videoUrl: data.video_url || data.url || data.data.play,
                                    title: data.title || "ÙÙŠØ¯ÙŠÙˆ TikTok",
                                    author: data.author || "Ù…Ø³ØªØ®Ø¯Ù…"
                                }
                            };
                        }
                }
                
                return { success: false };
            }
        }

        // ====== Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ======
        const downloader = new ComprehensiveTikTokDownloader();
        const stats = new Statistics();

        const videoUrlInput = document.getElementById('videoUrl');
        const fetchBtn = document.getElementById('fetchBtn');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const progressFill = document.getElementById('progressFill');
        const resultSection = document.getElementById('resultSection');
        const videoPreview = document.getElementById('videoPreview');
        const downloadBtn = document.getElementById('downloadBtn');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const videoTitle = document.getElementById('videoTitle');
        const videoAuthor = document.getElementById('videoAuthor');
        const videoDuration = document.getElementById('videoDuration');
        const apiSource = document.getElementById('apiSource');

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }

        function showSuccess(msg) {
            successMessage.textContent = msg;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 5000);
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }

        function showLoading() {
            loading.style.display = 'block';
            resultSection.style.display = 'none';
            progressFill.style.width = '0%';
        }

        function hideLoading() {
            loading.style.display = 'none';
            progressFill.style.width = '0%';
        }

        function simulateProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 90) {
                    progress = 90;
                    clearInterval(interval);
                }
                progressFill.style.width = progress + '%';
            }, 200);
        }

        function isValidTikTokUrl(url) {
            const patterns = [
                /https?:\/\/(www\.)?tiktok\.com\/.+\/video\/\d+/,
                /https?:\/\/(vm|vt)\.tiktok\.com\/.+/,
                /https?:\/\/tiktok\.com\/@.+\/video\/\d+/,
                /https?:\/\/m\.tiktok\.com\/v\/\d+/
            ];
            return patterns.some(pattern => pattern.test(url));
        }

        fetchBtn.addEventListener('click', async () => {
            const url = videoUrlInput.value.trim();
            
            if (!url) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ TikTok');
                return;
            }
            
            if (!isValidTikTokUrl(url)) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· TikTok ØµØ­ÙŠØ­');
                return;
            }
            
            hideMessages();
            showLoading();
            fetchBtn.disabled = true;
            simulateProgress();
            
            try {
                const result = await downloader.downloadVideo(url);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                videoPreview.src = result.data.videoUrl;
                videoTitle.textContent = result.data.title;
                videoAuthor.textContent = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: @${result.data.author}`;
                videoDuration.textContent = `Ø§Ù„Ù…Ø¯Ø©: ${result.data.duration || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} Ø«Ø§Ù†ÙŠØ©`;
                apiSource.textContent = `Ø§Ù„Ù…ØµØ¯Ø±: ${downloader.currentServer}`;
                
                hideLoading();
                resultSection.style.display = 'block';
                showSuccess('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!');
                
                stats.recordDownload(true);
                
            } catch (error) {
                hideLoading();
                showError(error.message);
                stats.recordDownload(false);
            } finally {
                fetchBtn.disabled = false;
            }
        });

        downloadBtn.addEventListener('click', () => {
            if (downloader.currentVideo) {
                const a = document.createElement('a');
                a.href = downloader.currentVideo.videoUrl;
                a.download = `tiktok-${Date.now()}.mp4`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showSuccess('Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...');
            }
        });

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Enter
        videoUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchBtn.click();
            }
        });

        // ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ======
        document.addEventListener('DOMContentLoaded', () => {
            checkServers();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø¯Ù… ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(checkServers, 30000);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(() => stats.updateDisplay(), 10000);
        });
    </script>
</body>
</html>
